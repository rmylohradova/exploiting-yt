import pandas as pd
from pprint import pprint
from googleapiclient.discovery import build
from typing import List
import os
from dotenv import load_dotenv

load_dotenv()
yt_key = os.environ['YOUTUBE_API_KEY']


def extract_categories():
    """By using google api client, building a service object for Google Youtube api, calling instance method to
    return list from
    videoCategories endpoint. Fetching video category name and id data into separate lists, then zipping 2 lists into interator of tuples
    to make a pandas DataFrame"""
    try:
        youtube = build('youtube', 'v3', developerKey=yt_key)
        request = youtube.videoCategories().list(
            part='snippet',
            regionCode='ua',
        )
        response = request.execute()
        cat_id: List[int] = []
        cats: List[str] = []
        n_cats = len(response['items'])
        for i in range(n_cats):
            cat_id.append(int(response['items'][i]['id']))
            cats.append(response['items'][i]['snippet']['title'])
        ctgrs_df = pd.DataFrame(list(zip(cats, cat_id)), columns=['Category', 'Category_id'])
        load(ctgrs_df)
    except Exception as e:
        print("Data extraction error" + str(e))

def load(df, tbl)



